<!DOCTYPE html>
<html lang="ru">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Тест MMPI (566 Вопросов)</title>
    <link rel="stylesheet" href="style.css">
    <style>
        /* Встроенные стили — можно вынести в style.css */
        .pay-gate {
            max-width: 980px;
            margin: 28px auto;
            padding: 20px;
            border-radius: 16px;
            background: linear-gradient(180deg, #fff, #fbfdff);
            box-shadow: 0 12px 30px rgba(13, 30, 70, .06);
        }

        .pay-grid {
            display: flex;
            gap: 20px;
            flex-wrap: wrap;
            align-items: stretch;
        }

        .pay-left {
            flex: 1 1 360px;
            min-width: 280px;
            padding: 18px;
        }

        .pay-right {
            width: 360px;
            min-width: 260px;
            padding: 18px;
            background: linear-gradient(180deg, #f7fbff, #f0f6ff);
            border-radius: 12px;
            box-shadow: inset 0 1px 0 rgba(255, 255, 255, .6);
        }

        .tariff {
            border-radius: 12px;
            padding: 12px;
            background: #fff;
            box-shadow: 0 6px 18px rgba(8, 20, 60, .04);
            margin-bottom: 12px;
            border: 1px solid rgba(14, 35, 90, .04)
        }

        .tariff .price {
            font-weight: 800;
            font-size: 1.5rem;
            color: #244fd1;
        }

        .btn {
            display: inline-block;
            padding: 10px 14px;
            border-radius: 10px;
            font-weight: 600;
            cursor: pointer;
            text-decoration: none;
            border: none;
        }

        .btn-primary {
            background: linear-gradient(90deg, #2c66f9, #5b35d6);
            color: #fff;
        }

        .btn-ghost {
            background: transparent;
            color: #2c66f9;
            border: 1px solid rgba(44, 102, 249, .12);
        }

        .small {
            font-size: .9rem;
            color: #475569
        }

        input[type=file] {
            display: block;
            margin-top: 8px;
        }

        .receipt-preview {
            margin-top: 12px;
            max-height: 160px;
            border-radius: 8px;
            object-fit: contain;
            display: block;
        }

        .pay-note {
            margin-top: 12px;
            color: #374151;
            font-size: .95rem
        }

        .pay-actions {
            margin-top: 14px;
            display: flex;
            gap: 10px;
            flex-wrap: wrap
        }

        .success-pill {
            display: inline-block;
            padding: 8px 12px;
            background: #ecfdf5;
            color: #065f46;
            border-radius: 999px;
            font-weight: 600;
        }

        @media (max-width:880px) {
            .pay-right {
                order: 2;
                width: 100%
            }

            .pay-left {
                order: 1;
                width: 100%
            }

            .pay-grid {
                flex-direction: column
            }
        }
    </style>
</head>

<body>
    <!-- Оверлей меню -->
    <div class="overlay-menu" id="overlay-menu">

        <div class="overlay-body">
            <div class="overlay-logo">
                <div class="logo-text">Rönesans Danışmanlık</div>
            </div>

            <!-- Навигация -->
            <nav class="menu-links">
                <a href="index-ru.html">Главная</a>
                <a href="about-ru.html">О тесте</a>
                <a href="aboutme-ru.html">Обо мне</a>
                <a href="blog-ru.html">Блог</a>
                <a href="payments-ru.html">Оплата</a>
                <a href="privacy-ru.html">Политика конфиденциальности</a>
                <a href="index-ru.html">Отзывы о нас</a>
                <a href="index-ru.html">Контакты</a>

            </nav>
            <div class="overlay-footer">
                <!-- Переключатель языков -->
                <div class="lang-switch">
                    <a href="index-ru.html"><img src="https://flagcdn.com/w20/ru.png" alt="Рус"> Рус</a>
                    <a href="index-en.html"><img src="https://flagcdn.com/w20/gb.png" alt="Eng"> Eng</a>
                    <a href="index.html"><img src="https://flagcdn.com/w20/tr.png" alt="Türkçe"> Türkçe</a>
                </div>
            </div>
            <div class="social-icons">
                <a href="https://wa.me/71234567890" target="_blank" aria-label="WhatsApp">
                    <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/whatsapp.svg" alt="WhatsApp">
                </a>
                <a href="https://t.me/yourchannel" target="_blank" aria-label="Telegram">
                    <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/telegram.svg" alt="Telegram">
                </a>
                <a href="https://twitter.com/yourpage" target="_blank" aria-label="Twitter">
                    <img src="https://cdn.jsdelivr.net/gh/simple-icons/simple-icons/icons/twitter.svg" alt="Twitter">
                </a>
            </div>
        </div>
    </div>
    <!-- Бургер (SVG) -->
    <div class="burger-btn" id="burger-btn" aria-label="Открыть или закрыть меню">
        <svg class="burger-icon" width="20" height="20" viewBox="0 0 24 24" fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <line x1="4" y1="7" x2="20" y2="7" stroke="white" stroke-width="2" stroke-linecap="round" />
            <line x1="8" y1="12" x2="20" y2="12" stroke="white" stroke-width="2" stroke-linecap="round" />
            <line x1="12" y1="17" x2="20" y2="17" stroke="white" stroke-width="2" stroke-linecap="round" />
        </svg>

        <svg class="close-icon hidden" width="24" height="24" viewBox="0 0 24 24" fill="none"
            xmlns="http://www.w3.org/2000/svg">
            <line x1="6" y1="6" x2="18" y2="18" stroke="white" stroke-width="2" stroke-linecap="round" />
            <line x1="6" y1="18" x2="18" y2="6" stroke="white" stroke-width="2" stroke-linecap="round" />
        </svg>
    </div>
    <header>
        <div class="header-container">
            <div class="logo">Rönesans Danışmanlık</div>
            <nav class="nav-center">
                <a href="index-ru.html">Главная</a>
                <a href="about-ru.html">О тесте</a>
                <a href="index-ru.html#about">Обо мне</a>
                <a href="blog-ru.html">Блог</a>
            </nav>
            <div class="lang-switch" id="langSwitch">
                <a href="mmpi-test-ru.html" data-lang="ru" class="active">Рус</a>
                <a href="mmpi-test-en.html" data-lang="en">Eng</a>
                <a href="mmpi-test-tr.html" data-lang="tr">Türkçe</a>
            </div>
        </div>
    </header>
    <div id="paymentGate" class="pay-gate" aria-live="polite">
        <div style="display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap">
            <div>
                <h3 style="margin:0;font-size:1.25rem;font-weight:700">Оплата доступа к MMPI-тесту</h3>
                <div class="small" style="margin-top:6px">Пожалуйста, оплатите выбранный тариф. После оплаты — загрузите
                    чек и нажмите "Я оплатил".</div>
            </div>

            <div id="paidBadge" style="display:none" class="success-pill">Оплата подтверждена</div>
        </div>

        <div class="pay-grid" style="margin-top:16px">
            <!-- LEFT: tariffs & instructions -->
            <div class="pay-left">
                <div class="tariff">
                    <div style="display:flex;justify-content:space-between;align-items:center">
                        <div><strong>Базовый</strong>
                            <div class="small">Полный тест, профиль, 20-мин. консультация</div>
                        </div>
                        <div class="price">$100</div>
                    </div>
                    <label style="display:block;margin-top:10px"><input type="radio" name="tariff" value="100" checked>
                        Выбрать</label>
                </div>

                <div class="tariff" style="border:2px solid rgba(44,102,249,.12)">
                    <div style="display:flex;justify-content:space-between;align-items:center">
                        <div><strong>Стандарт</strong>
                            <div class="small">Профиль + график, 40-мин. консультация</div>
                        </div>
                        <div class="price">$150</div>
                    </div>
                    <label style="display:block;margin-top:10px"><input type="radio" name="tariff" value="150">
                        Выбрать</label>
                </div>

                <div class="tariff">
                    <div style="display:flex;justify-content:space-between;align-items:center">
                        <div><strong>Премиум</strong>
                            <div class="small">Расширенный отчёт, 60-мин. сессия + сопровождение</div>
                        </div>
                        <div class="price">$200</div>
                    </div>
                    <label style="display:block;margin-top:10px"><input type="radio" name="tariff" value="200">
                        Выбрать</label>
                </div>

                <div style="margin-top:12px" class="pay-note">
                    <strong>Реквизиты для перевода (Garanti Bank):</strong>
                    <div
                        style="margin-top:8px; background:#fff;padding:12px;border-radius:8px;border:1px solid rgba(14,35,90,.04)">
                        <div><strong>Банк:</strong> Garanti Bank</div>
                        <div><strong>Получатель:</strong> Rönesans Danışmanlık</div>
                        <div><strong>IBAN:</strong> TR00 0000 0000 0000 0000 0000 00</div>
                        <div><strong>SWIFT:</strong> TGBATRISXXX</div>
                        <div><strong>Назначение:</strong> MMPI Test + Ваше ФИО</div>
                    </div>

                    <div class="pay-actions" style="margin-top:12px">
                        <button id="copyDetailsBtn" class="btn btn-ghost">Скопировать реквизиты</button>
                        <button id="openWhatsBtn" class="btn btn-ghost">Открыть WhatsApp</button>
                        <button id="openTGBtn" class="btn btn-ghost">Открыть Telegram</button>
                    </div>
                </div>
            </div>

            <!-- RIGHT: receipt upload & confirm -->
            <div class="pay-right" aria-hidden="false">
                <div style="font-weight:600">Загрузите чек / квитанцию</div>
                <div class="small" style="margin-top:6px">Сделайте фото или скан квитанции об оплате и загрузите файл
                    (jpg/png/pdf). Мы сохраняем копию локально для подтверждения.</div>

                <input id="receiptFile" type="file" accept="image/*,.pdf" />
                <img id="receiptPreview" class="receipt-preview" style="display:none" alt="preview">
                <div id="receiptName" style="margin-top:8px;color:#334155;font-size:.95rem"></div>

                <div style="margin-top:12px;display:flex;gap:8px;flex-wrap:wrap">
                    <button id="saveReceiptBtn" class="btn btn-primary">Отправить чек</button>
                    <button id="clearReceiptBtn" class="btn btn-ghost">Сбросить</button>
                </div>

                <div style="margin-top:12px">
                    <label style="display:flex;gap:8px;align-items:center"><input id="agreeCheckbox" type="checkbox">
                        <span class="small">Я подтвердил перевод и отправил чек</span></label>
                </div>

                <div style="margin-top:14px; display:flex; gap:10px;">
                    <button id="confirmPaidBtn" class="btn btn-primary" style="opacity:.95">Я оплатил — открыть
                        тест</button>
                    <button id="cancelPayBtn" class="btn btn-ghost">Отмена</button>
                </div>

                <div id="payMessage" style="margin-top:12px;color:#334155;font-size:.95rem"></div>
            </div>
        </div>
    </div>
    <div id="intro" class="container">
        <div class="test-form">
            <h1 class="form-title">Начать тест</h1>
            <div class="form-group">
                <label for="birthDate" id="birthDateLabel">Дата рождения <span class="required-star">*</span></label>
                <input type="text" id="birthDate" name="birthDate" placeholder="дд.мм.гггг">
                <div class="error" id="birthDateError"></div>
            </div>
            <div class="form-group">
                <span class="error" id="genderError"></span>
                <label for="gender">Пол <span class="required-star">*</span></label>
                <select id="gender" name="gender">
                    <option value="0">Мужской</option>
                    <option value="1">Женский</option>
                </select>
            </div>
            <div class="form-group">
                <span class="error" id="surnameError"></span>
                <label for="surname">Фамилия <span class="required-star">*</span></label>
                <input type="text" id="surname" required>
            </div>
            <div class="form-group">
                <span class="error" id="nameError"></span>
                <label for="name">Имя <span class="required-star">*</span></label>
                <input type="text" id="name" required>
            </div>
            <div class="form-group">
                <span class="error" id="patronymicError"></span>
                <label for="patronymic">Отчество</label>
                <input type="text" id="patronymic">
            </div>
            <div class="form-group">
                <span class="error" id="emailError"></span>
                <label for="email">E-mail <span class="required-star">*</span></label>
                <input type="email" id="email" placeholder="Результаты будут отправлены на этот адрес" required>
            </div>
            <div class="form-group">
                <span class="error" id="phoneError"></span>
                <label for="phone">Телефон <span class="required-star">*</span></label>
                <input type="tel" id="phone" placeholder required>
            </div>
            <div class="form-group">
                <span class="error" id="cityError"></span>
                <label for="city">Город</label>
                <input type="text" id="city">
            </div>
            <div class="form-group">
                <span class="error" id="educationError"></span>
                <label for="education">Образование <span class="required-star">*</span></label>
                <select id="education">
                    <option value="shkolnoe">Школьное</option>
                    <option value="srednee_specialnoe">Среднее специальное</option>
                    <option value="vysshee">Высшее</option>
                </select>
            </div>
            <div class="form-group">
                <span class="error" id="whatsappTelegramError"></span>
                <label for="whatsappTelegram">WhatsApp/Telegram</label>
                <input type="text" id="whatsappTelegram" placeholder="Введите номер или @username">
            </div>
            <div class="form-group consent-group">
                <span class="error" id="consentError"></span>
                <input type="checkbox" id="consent" required>
                <label for="consent" class="consent-label">Согласие на обработку персональных данных</label>
            </div>
            <div class="form-actions">
                <button onclick="startTest()" class="btn primary">Начать тест</button>
            </div>
        </div>
    </div>
    <div id="questionContainer" class="container" style="display: none; text-align: center; position: relative;">
        <div id="prevArrow" class="nav-arrow" style="left: 10px;">«</div>
        <h2 id="questionText"
            style="font-size: 1.5em; color: #333; padding: 20px; background: #f9f9f9; border-radius: 10px;"></h2>
        <div id="answerOptions"
            style="margin: 20px 0; display: flex; flex-direction: column; align-items: center; gap: 10px;"></div>
        <div class="progress-line-wrapper">
            <div class="progress-line">
                <div class="progress-indicator" id="progressIndicator"></div>
            </div>
            <div class="progress-name">Аноним</div>
        </div>
        <div id="nextArrow" class="nav-arrow" style="right: 10px;">»</div>
        <p id="progress" style="font-size: 1em; color: #666;">Вопрос <span id="currentQuestion">1</span> / 566</p>
        <button id="showResultBtn" onclick="window.submitTest()"
            style="display: none; padding: 10px 20px; font-size: 1em; background: #2196F3; color: white; border: none; border-radius: 5px;">
            Завершить тест
        </button>
    </div>
    <div id="resultContainer" class="container" style="display: none;">
        <h2 id="resultTitle">Результаты</h2>
        <canvas id="mmpiChart" style="max-width: 100%; height: 300px;"></canvas>
        <p id="resultText"></p>
        <div id="resultTable" class="result-section"></div>
    </div>
    <script>
        localStorage.setItem('selectedLanguage', 'ru');
        console.log('Язык установлен в localStorage: ru');
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/inputmask/5.0.6-beta.37/inputmask.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="questions.js"></script>
    <script src="script.js" defer></script>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const input = document.getElementById('birthDate');

            input.addEventListener('input', (event) => {
                let value = input.value.replace(/[^\d]/g, ''); // Убираем все символы, кроме цифр
                if (value.length > 2 && value.length < 5) {
                    value = value.slice(0, 2) + '.' + value.slice(2); // Добавляем точку после 2 цифр
                } else if (value.length > 4) {
                    value = value.slice(0, 2) + '.' + value.slice(2, 4) + '.' + value.slice(4, 8); // Добавляем точку после 4 цифр
                }
                input.value = value; // Устанавливаем отформатированное значение обратно в поле
            });
        });
    </script>
    <script>
        const burgerBtn = document.getElementById('burger-btn');
        const overlayMenu = document.getElementById('overlay-menu');
        const burgerIcon = burgerBtn.querySelector('.burger-icon');
        const closeIcon = burgerBtn.querySelector('.close-icon');

        burgerBtn.addEventListener('click', () => {
            const isOpen = overlayMenu.classList.toggle('open');
            burgerBtn.classList.toggle('active', isOpen); // фон меняем

            // переключаем иконки
            burgerIcon.style.display = isOpen ? 'none' : 'block';
            closeIcon.style.display = isOpen ? 'block' : 'none';
        });
    </script>
    <script>
  // ====== Payment-gate JS ======
  (function(){
    const copyBtn = document.getElementById('copyDetailsBtn');
    const openWhats = document.getElementById('openWhatsBtn');
    const openTG = document.getElementById('openTGBtn');
    const receiptFile = document.getElementById('receiptFile');
    const receiptPreview = document.getElementById('receiptPreview');
    const receiptName = document.getElementById('receiptName');
    const saveBtn = document.getElementById('saveReceiptBtn');
    const clearBtn = document.getElementById('clearReceiptBtn');
    const agreeCheckbox = document.getElementById('agreeCheckbox');
    const confirmPaid = document.getElementById('confirmPaidBtn');
    const payMsg = document.getElementById('payMessage');
    const paidBadge = document.getElementById('paidBadge');

    // bank details text (for copy)
    const bankText = `Банк: Garanti Bank
Получатель: Rönesans Danışmanlık
IBAN: TR00 0000 0000 0000 0000 0000 00
SWIFT: TGBATRISXXX
Назначение: MMPI Test + Ваше ФИО`;

    copyBtn.addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(bankText);
        payMsg.textContent = 'Реквизиты скопированы в буфер обмена.';
        setTimeout(()=> payMsg.textContent = '', 3000);
      } catch(e) {
        payMsg.textContent = 'Не удалось скопировать — скопируйте вручную.';
      }
    });

    openWhats.addEventListener('click', () => {
      // prefill message
      const message = encodeURIComponent('Здравствуйте, я оплатил(а) MMPI тест. Прошу открыть доступ. Мои ФИО: [Введите имя].');
      // open WhatsApp Web (works on desktop/mobile)
      window.open(`https://wa.me/?text=${message}`, '_blank');
    });

    openTG.addEventListener('click', () => {
      const message = encodeURIComponent('Здравствуйте, я оплатил(а) MMPI тест. Прошу открыть доступ. Мои ФИО: [Введите имя].');
      window.open(`https://t.me/share/url?url=&text=${message}`, '_blank');
    });

    // preview receipt
    receiptFile.addEventListener('change', (e) => {
      payMsg.textContent = '';
      const file = e.target.files[0];
      if (!file) return;
      receiptName.textContent = file.name + ' • ' + Math.round(file.size/1024) + ' KB';
      if (file.type.startsWith('image/')) {
        const reader = new FileReader();
        reader.onload = function(evt) {
          receiptPreview.src = evt.target.result;
          receiptPreview.style.display = 'block';
        };
        reader.readAsDataURL(file);
      } else {
        receiptPreview.style.display = 'none';
      }
    });

    // save receipt to localStorage (base64) + metadata
    saveBtn.addEventListener('click', () => {
      const file = receiptFile.files[0];
      if (!file) {
        payMsg.textContent = 'Пожалуйста, загрузите файл чека перед отправкой.';
        return;
      }
      const reader = new FileReader();
      reader.onload = function(evt) {
        const payload = {
          name: file.name,
          type: file.type,
          size: file.size,
          dataUrl: evt.target.result,
          tariff: document.querySelector('input[name="tariff"]:checked')?.value || '100',
          time: new Date().toISOString()
        };
        try {
          localStorage.setItem('mmpi_receipt', JSON.stringify(payload));
          payMsg.textContent = 'Чек сохранён локально. Теперь подтвердите оплату.';
        } catch (err) {
          payMsg.textContent = 'Ошибка при сохранении чека. Возможно, файл слишком большой.';
        }
      };
      // read as dataURL even for pdf (will be base64)
      reader.readAsDataURL(file);
    });

    clearBtn.addEventListener('click', () => {
      receiptFile.value = '';
      receiptPreview.style.display = 'none';
      receiptName.textContent = '';
      localStorage.removeItem('mmpi_receipt');
      payMsg.textContent = 'Чек очищен.';
    });

    // Confirm payment -> allow to open test
    confirmPaid.addEventListener('click', () => {
      // check: user must check agree or upload saved receipt
      const saved = localStorage.getItem('mmpi_receipt');
      if (!agreeCheckbox.checked && !saved) {
        payMsg.textContent = 'Подтвердите оплату (поставьте галочку) или загрузите и отправьте чек.';
        return;
      }

      // mark payment done (persist)
      localStorage.setItem('mmpi_paymentDone', 'true');
      localStorage.setItem('mmpi_paymentTime', new Date().toISOString());
      // also keep which tariff
      const tariff = document.querySelector('input[name="tariff"]:checked')?.value || '100';
      localStorage.setItem('mmpi_tariff', tariff);

      // update UI: hide gate, show form (#intro)
      const gate = document.getElementById('paymentGate');
      if (gate) gate.style.display = 'none';

      // show paid badge
      paidBadge.style.display = 'inline-block';

      // reveal form / intro
      const intro = document.getElementById('intro');
      if (intro) intro.style.display = 'block';

      // optionally scroll to form
      setTimeout(()=> {
        intro.scrollIntoView({behavior:'smooth', block:'start'});
      }, 150);

      payMsg.textContent = 'Оплата подтверждена локально — форма доступна. После прохождения теста психолог свяжется с вами.';
    });

    // On page load: if payment already done, hide gate and show form
    document.addEventListener('DOMContentLoaded', () => {
      const paid = localStorage.getItem('mmpi_paymentDone');
      const gate = document.getElementById('paymentGate');
      const intro = document.getElementById('intro');
      if (paid === 'true') {
        if (gate) gate.style.display = 'none';
        if (intro) intro.style.display = 'block';
        paidBadge.style.display = 'inline-block';
      } else {
        if (gate) gate.style.display = 'block';
        if (intro) intro.style.display = 'none';
      }
    });

    // Optional: Cancel — refresh to start again
    document.getElementById('cancelPayBtn').addEventListener('click', () => {
      if (confirm('Отменить процесс оплаты и вернуться?')) {
        localStorage.removeItem('mmpi_receipt');
        localStorage.removeItem('mmpi_paymentDone');
        const gate = document.getElementById('paymentGate');
        const intro = document.getElementById('intro');
        if (gate) gate.style.display = 'block';
        if (intro) intro.style.display = 'none';
        payMsg.textContent = 'Процесс оплаты отменён.';
      }
    });
  })();
</script>
</body>

</html>